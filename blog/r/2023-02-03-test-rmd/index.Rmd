---
layout: post
title: 'Using Rmarkdown with Eleventy'
author: 'Michael Schmidt'
date: 2023-02-09
tags: ["Eleventy", "Rmd"]
output:
  md_document:
    variant: commonmark
    preserve_yaml: TRUE
    df_print: tibble
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  class.output="r"
)

```
I write a lot of R in my life.  I'm also a web developer that does most of my writing on this blog in markdown.  Up until now these two worlds have been separate.  I know and use Rmarkdown at work but it always has seemed like a pain to get Rmarkdown to work on this site which is generated using 11ty (eleventy). Up until now, to get my R work on this site, I have been writing R in another document and manually copying over code and outputs to markdown files on this site. Given how ineficient that process is, I figured it was time to figure out how to write Rmarkdown and render it more seamlessly with this site. 

To be clear, this isn't some automated system to get Rmarkdown to build with eleventy.  What it is, is a system to write Rmarkdown, then render that document to a markdown file using R so that eleventy, or another static site generator, can build it into the site. This also isn't a process for folks who just want to write Rmarkdown and nothing else.  For those folks I'd recommend something like blogdown. This is kind of a unique case because I post about things other than R on my blog so I like the flexibility of a non R centric system. 

As proof of concept, this page is an Rmarkdown document that I'm rendering to a `md` document and converting to `html` with eleventy. 

## Eleventy Configuration
First, you need to put your Rmarkdown file in a folder is named like a post typically would be with the post slug.  For example I put this post in a folder named `2023-02-03-test-rmd/` in a folder with all my other posts.  Within that folder you put your Rmarkdown file and name it `index.Rmd`. Now when you run `rmarkdown::render("2023-02-03-test-rmd/index.Rmd")` a `index.md` file will be rendered in your post folder and an images folder will be created with all of your assets that Rmarkdown generates, which is typically just images of plots.  All of the image paths should work without any eleventy changes (after completing the next step). I'm not sure about other static site generators, but I would imagine this would work in some.

Next, we need to make some eleventy config (`.eleventy.js` for most) changes so that images generated by Rmarkdown will be added to the _site folder.  Rmarkdown `render` generates all documents in the current folder, including the images. The way I have my 11ty site setup currently is that I put all images in an assets folder that is outside of my posts folder and I add a pass through copy to the site folder. No other images are copied to the site folder. If the goal is to make this as easy as possible we need to add a line to our configuration that will copy all images to our `_site` folder keeping their original file structure. To do this you can add a `addPassthroughCopy()` in your `.eleventy.js` configuration file. 

```js
module.exports = function(eleventyConfig){
  eleventyConfig.addPassthroughCopy("blog/r/**/*.png")
}
```
I limited to the copy to my `blog/r/` folder becuase that is where Rmarkdown files will be and I don't want to copy over my assets folder twice which would return an error. That's it.  That is all the eleventy configuration you need to do. Now let's move on the the Rmarkdown file.

## Rmarkdown front matter
The important part here is the output section.  This is what Rmarkdown uses to determine how to render your Rmarkdown. 
```yml
---
layout: post
title: 'Using Rmarkdown with Eleventy'
author: 'Michael Schmidt'
date: '2023-02-03'
tags: ["Test Tag"]
# Above this is eleventy. Below this is Rmarkdown
output:
  md_document:
    variant: commonmark
    preserve_yaml: TRUE
    df_print: tibble
---
```
The output says markdown document with `md_document`, that is rendered using `commonmark` syntax, preserving the yaml (otherwise it is removed), and the `df_print: tibble` is optional to output tables in trunkated fashion. 

The last thing I needed to do was add a chunk option for my Rmarkdown chunks that would wrap the chunk outputs in code blocks.  You can do this like so: 
```r
knitr::opts_chunk$set(
  class.output="r"
)
```

After that you should be able to write Rmarkdown in you eleventy site.  When you render the Rmarkdown, it should create a markdown document that can be ingested by eleventy to make static html. 

As proof, below is just Rmarkdown rendered with `rmarkdown::render("path/to/index.Rmd")

```{r echo=TRUE}
library(palmerpenguins)
library(tidyverse)
```
```{r echo=TRUE}
penguins
```
This is some text.
```{r}
penguins%>%
  ggplot(aes(island, bill_length_mm))+
  geom_boxplot()+
  labs(title="Made this in Rmarkdown")+
  geom_jitter(width=0.1, alpha=0.5, size=2)+
  theme_minimal()
```