<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raster Distance Calculations</title>
    <meta name="description" content="">
    <link rel="stylesheet" href="/css/main.css">
  </head>
  <body>
    <header>
      
    </header>

    <main>
      <article class="post-content">
  <header class="post-header">
    <h1 class="post-title">Raster Distance Calculations</h1>
    <div class="post-meta">
      <time datetime="Invalid DateTime" class="post-time">December 18, 2018</time>
      <span>| tags:</span>
      <ul class="tags-list post-tag-list">
      
        
        <li><a href="/tags/r/" class="tag-list-tag">R</a></li>
      
        
        <li><a href="/tags/gis/" class="tag-list-tag">GIS</a></li>
      
        
        <li><a href="/tags/r/" class="tag-list-tag">R</a></li>
      
      </ul>
    </div>
  </header>
  <figure><a href="/img/r/assets/maps/distance_example_2.jpeg"><img src="/img/r/assets/maps/distance_example_2.jpeg" alt="image"></a></figure>
<p>There are many cases when I have needed to calculate a distance from a point or many points to a feature in GIS.  Until recently I have always used the <a href="http://pro.arcgis.com/en/pro-app/tool-reference/analysis/near.htm">near tool</a>.  This works really well for small datasets but can take forever with larger datasets.  The near calculation also only works with points (I'm sure that there is a raster equivalent I just haven't done the research on it).  I also really like to document where I got my data.  You can do that in ArcGIS but it is an added step to do it.</p>
<p>So, I'm back to R. Near calculations, or <code>distance()</code> calculations in r, are also slow, but because it is easy to loop through datasets to perform the same calculation many times, I don't mind running a program all night to calculate the distance to many objects.</p>
<p>There are two types of calculations that I need to perform for the analysis I'm doing.  The first is a distance to polygon layers.  The second is distance to line features.  It appears that you perform these calculation is very different ways.  We'll start with the distance to polygons because that one is a bit more strait forward although still bit confusing.</p>
<p>Source: I used this <a href="https://gis.stackexchange.com/questions/210506/how-to-calculate-distance-on-large-raster-in-r">Stack Exchange thread</a> for this example.</p>
<h2>Distance to polygon</h2>
<pre><code class="language-r">library(rgeos)
</code></pre>
<p>Make A raster</p>
<pre><code class="language-r">r&lt;- raster(ncol=200, nrow=150, xmn=-1000, xmx=1000, ymn=-100, ymx=900)
rr&lt;-setValues(r, 0)
</code></pre>
<p>Create a two polygons and merge (bind) them together.</p>
<pre><code class="language-r">##Make polygon 1
x&lt;- c(300, 500, 400, 289, 250)
y&lt;- c(300, 80, 20, 50, 80)
poly1&lt;-SpatialPolygons(list(Polygons(list(Polygon(data.frame(x,y))), ID=1)))

##Make polygon2
x&lt;- c(-500, -700, -600, -589, -450)
y&lt;- c(400, 180, 120, 150, 180)
poly2&lt;-SpatialPolygons(list(Polygons(list(Polygon(data.frame(x,y))), ID=1)))

##Merge and Plot the polygons
poly&lt;-bind (poly1, poly2)
plot(poly)
</code></pre>
<p>Mask raster by the geometry of the polygon.  You need to do this because the distance calculation works by calculating the distance of each cell to the nearest NA valued cell.  That is why when we made the raster we set the values of the whole raster to 0 instead of leaving them as NA <code>setValues(r, 0)</code>.</p>
<pre><code class="language-r">rrr&lt;-mask(rr, poly)
</code></pre>
<p>Run the distance calculation and then plot.</p>
<pre><code class="language-r">rD&lt;- distance(rrr)
plot(rD,
     legend.args=list(text='Distance (m)', side=4, line=3, cex=0.8))
plot(poly, add=T)
</code></pre>
<p>The finished product should look something like this:
<img src="/img/r/assets/maps/distance_to_polygon_example2.jpeg" alt="Distance to Polygon example."></p>
<h2>Distance to Line</h2>
<p>I utalized this <a href="https://gis.stackexchange.com/questions/233443/finding-distance-between-raster-pixels-and-line-features-in-r/233493">Stack Exchange Post</a></p>
<p>Load the libraries:</p>
<pre><code class="language-r">library(rgeos)
library(raster)
</code></pre>
<p>Make the same raster that we used for the last example:</p>
<pre><code class="language-r">## Make the same raster as above
r&lt;- raster(ncol=200, nrow=150, xmn=-1000, xmx=1000, ymn=-100, ymx=900)
r&lt;-setValues(r, 0)
</code></pre>
<p>Create two lines together each with their own ID.</p>
<pre><code class="language-r">##Make two lines
lines&lt;-SpatialLines(list(
  Lines(list(Line(cbind(c(300, 500, 400, 289, 250), c(300, 80, 20, 50, 80)))), ID=&quot;a&quot;),
  Lines(list(Line(cbind(c(-500, -700, -600, -589, -450), c(400, 180, 120, 150, 180)))), ID=&quot;b&quot;)
))
plot(lines)
</code></pre>
<p>Use gDistance from the lines to raster converted to points (this could take a long time) and use the ID to differentiate between the lines.  Then add the distances from the points to the raster.</p>
<pre><code class="language-r">##Calculate Distance from Raster to lines
distance&lt;-gDistance(lines, as(r, &quot;SpatialPoints&quot;), byid=TRUE)
r[]&lt;-apply(distance,1, min)
</code></pre>
<p>Then plot to see the result</p>
<pre><code class="language-r">plot(r,
     legend.args=list(text='Distance (m)', side=4, line=3, cex=0.8))
plot(lines, add=T)
</code></pre>
<figure><a href="/img/r/assets/maps/distance_to_lines_example.jpeg"><img src="/img/r/assets/maps/distance_to_lines_example.jpeg" alt="Raster to line calculation results."></a></figure>
<p><a href="/r/assets/scripts/raster/distance_to_calcs.r">Download the R file</a></p>

</article>

    </main>

    <footer></footer>

    <!-- Current page: /blog/r/2018-12-18-distance_calculation_for_raster/ -->
  </body>
</html>