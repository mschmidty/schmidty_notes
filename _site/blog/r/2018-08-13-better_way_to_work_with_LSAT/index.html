<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>How to download and work with LSAT data -  a better approach</title>
    <meta name="description" content="">
    <link rel="stylesheet" href="/css/main.css">
  </head>
  <body>
    <header>
      
    </header>

    <main>
      <article class="post-content">
  <header class="post-header">
    <h1 class="post-title">How to download and work with LSAT data -  a better approach</h1>
    <div class="post-meta">
      <time datetime="Invalid DateTime" class="post-time">August 13, 2018</time>
      <span>| tags:</span>
      <ul class="tags-list post-tag-list">
      
        
        <li><a href="/tags/r/" class="tag-list-tag">R</a></li>
      
        
        <li><a href="/tags/r/" class="tag-list-tag">R</a></li>
      
        
        <li><a href="/tags/landsat/" class="tag-list-tag">Landsat</a></li>
      
        
        <li><a href="/tags/gis/" class="tag-list-tag">GIS</a></li>
      
      </ul>
    </div>
  </header>
  <p>My last post was about working with the r <code>getlandsat</code> package to work with landsat data from NASA and the USGS.  This post will be a brief refinement on that process.</p>
<h2>Finding out what dataset you want?</h2>
<p>With this method, your first step is figuring out what tyle you want from the Landsat dataset. The convention relies on the <a href="https://landsat.usgs.gov/what-worldwide-reference-system-wrs">World Reference System 2</a>, for which a grid kml can be found <a href="https://landsat.usgs.gov/pathrow-shapefiles">here</a> that you can view in Google Earth.</p>
<p>In my case I needed tile path = 036 and row = 033.</p>
<h2>Figuring out what images are available for your tile.</h2>
<p>Amazon provides an API to download all of the images.  To figure out what scenes are available, Amazon provides a scene list. I used R to view and subset the scene list:</p>
<pre><code class="language-r">library(dplyr)

file&lt;-&quot;https://landsat-pds.s3.amazonaws.com/c1/L8/scene_list.gz&quot; ##create variable that equals the scene list zip file.
scene_list&lt;-read_csv(file) ##unzip and read the scene list with the package dplyr.
scene_list %&gt;%
  filter(path==036 &amp; row==033 &amp; cloudCover&lt;20) ##View Scene list, subsetting results by path and row. I also subsetted the scenes to scenes with less than 20% cloud cover.
</code></pre>
<p>based on this, I decided I wanted <code>https://s3-us-west-2.amazonaws.com/landsat-pds/c1/L8/036/033/LC08_L1TP_036033_20180609_20180615_01_T1/index.html</code>.  That is just a webpage with a bunch of links to raster tile band. To work with the landsat data, we want the first 7 bands, but it is easiest to just download all of the the links.  To do this we use a handy terminal command called <code>wget</code>.  Which essentially downloads all of the link contents on the index page.</p>
<p>To perform the download type open the terminal on mac or download git for windows, <code>cd</code> into the folder you wish to download the files to and type:</p>
<pre><code class="language-bash">wget -r -p https://s3-us-west-2.amazonaws.com/landsat-pds/c1/L8/036/033/LC08_L1TP_036033_20180609_20180615_01_T1/index.html
</code></pre>
<p>This will download all the tiles to the folder. For more on wget, check out the <a href="http://manpages.ubuntu.com/manpages/bionic/en/man1/wget.1.html">man pages</a>. Each tile download is about 1Gb, so the download may take a while.</p>
<h3>downloading a list of URL files with wget</h3>
<pre><code class="language-bash">wget -r -p -i text_file_name.txt
</code></pre>
<h2>Creating a raster brick and using the data</h2>
<p>The best way to get the data and use it once it is downloaded is to create a list of all of the file locations for the tiles.  Because the file names and locations will all be the same, we can us <code>paste0</code> in r to make a list and then turn that list into a raster brick.</p>
<pre><code class="language-r">raslist&lt;-paste0(&quot;s3-us-west-2.amazonaws.com/landsat-pds/c1/L8/036/033/LC08_L1TP_036033_20180609_20180615_01_T1/LC08_L1TP_036033_20180609_20180615_01_T1_B&quot;, 1:7,&quot;.tif&quot;)
raslist
</code></pre>
<p>Your output should look like this:</p>
<pre><code class="language-r">##[1] &quot;s3-us-west-2.amazonaws.com/landsat-pds/c1/L8/036/033/LC08_L1TP_036033_20180609_20180615_01_T1/LC08_L1TP_036033_20180609_20180615_01_T1_B1.tif&quot;
##[2] &quot;s3-us-west-2.amazonaws.com/landsat-pds/c1/L8/036/033/LC08_L1TP_036033_20180609_20180615_01_T1/LC08_L1TP_036033_20180609_20180615_01_T1_B2.tif&quot;
##[3] &quot;s3-us-west-2.amazonaws.com/landsat-pds/c1/L8/036/033/LC08_L1TP_036033_20180609_20180615_01_T1/LC08_L1TP_036033_20180609_20180615_01_T1_B3.tif&quot;
##[4] &quot;s3-us-west-2.amazonaws.com/landsat-pds/c1/L8/036/033/LC08_L1TP_036033_20180609_20180615_01_T1/LC08_L1TP_036033_20180609_20180615_01_T1_B4.tif&quot;
##[5] &quot;s3-us-west-2.amazonaws.com/landsat-pds/c1/L8/036/033/LC08_L1TP_036033_20180609_20180615_01_T1/LC08_L1TP_036033_20180609_20180615_01_T1_B5.tif&quot;
##[6] &quot;s3-us-west-2.amazonaws.com/landsat-pds/c1/L8/036/033/LC08_L1TP_036033_20180609_20180615_01_T1/LC08_L1TP_036033_20180609_20180615_01_T1_B6.tif&quot;
##[7] &quot;s3-us-west-2.amazonaws.com/landsat-pds/c1/L8/036/033/LC08_L1TP_036033_20180609_20180615_01_T1/LC08_L1TP_036033_20180609_20180615_01_T1_B7.tif&quot;
</code></pre>
<p>We can then use the <code>raster</code> function <code>stack()</code> to create a raster brick (merge all of the separate landsat tiffs).</p>
<pre><code class="language-r">library(raster)
landsat&lt;-stack(raslist)
landsat

## class       : RasterStack
## dimensions  : 7771, 7641, 59378211, 7  (nrow, ncol, ncell, nlayers)
## resolution  : 30, 30  (x, y)
## extent      : 533685, 762915, 4190385, 4423515  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=utm +zone=12 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0
## names       : LC08_L1TP//5_01_T1_B1, LC08_L1TP//5_01_T1_B2, LC08_L1TP//5_01_T1_B3, LC08_L1TP//5_01_T1_B4, LC08_L1TP//5_01_T1_B5, LC08_L1TP//5_01_T1_B6, LC08_L1TP//5_01_T1_B7
## min values  :                     0,                     0,                     0,                     0,                     0,                     0,                     0
## max values  :                 65535,                 65535,                 65535,                 65535,                 65535,                 65535,                 65535
</code></pre>
<p>Now we can view the data using <code>plotRGB</code> creating two compostites.</p>
<pre><code class="language-r">par(mfrow = c(1,2))
plotRGB(landsat, r=3, g=2, b=1, axes=TRUE,  stretch=&quot;hist&quot;, main=&quot;Landsat True Color Composite&quot;)
plotRGB(landsat, r=5, g=4, b=3, axes=TRUE,  stretch=&quot;lin&quot;, main=&quot;Lansat False Color Composite&quot;)
</code></pre>
<h2>Resources</h2>
<ul>
<li><a href="https://www.earthdatascience.org/courses/earth-analytics/multispectral-remote-sensing-data/landsat-data-in-r-geotiff/">University of Colorado Tutorial on working with landsat</a></li>
</ul>

</article>

    </main>

    <footer></footer>

    <!-- Current page: /blog/r/2018-08-13-better_way_to_work_with_LSAT/ -->
  </body>
</html>